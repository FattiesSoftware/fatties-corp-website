"undefined"!=typeof jQuery&&function($){"use strict";class HandleAll{constructor(controlView){this.controls=$(controlView).get(0).$el.parentsUntil(".elementor-controls-stack"),this.editor=this.controls.find(".elementor-wp-editor"),this.currentSession=null}async getContent(){const editorId=this.editor.attr("id");if(window.parent.tinyMCE&&editorId){const editor=window.parent.tinyMCE.get(editorId);if(editor){const content=editor.getContent();return content.replace(/<\/?[^>]+(>|$)/g,"")}}}async shortContent(content){const postContent=content;try{let currentSession=null;const summarizer=await window.ai.summarizer.create({sharedContext:"A blog post",type:"headline",length:"short",format:"plain-text"});this.currentSession=summarizer,currentSession=summarizer;const stream=summarizer.summarizeStreaming(postContent,{context:"Avoid any toxic language and be as constructive as possible."});let result="";for await(const value of stream){result=value.replaceAll("\n\n\n\n","\n\n");const footer=document.querySelector(".swal2-footer");footer&&(footer.style.display="none"),Swal.update({html:`<textarea class="result-content" disabled>${result}</textarea>`,footer:null,showCloseButton:!0,didClose:()=>{currentSession&&(currentSession.destroy(),currentSession=null)}});const textarea=document.querySelector(".result-content");textarea&&(textarea.scrollTop=textarea.scrollHeight),Swal.showLoading()}return result}catch(error){}}async writeContent(inputText,contextInfo="",additionalText=""){try{let currentSession=null;const session=await window.ai.languageModel.create();this.currentSession=session;let context="\n            Avoid any toxic language and be as constructive as possible.\n          ";contextInfo&&(context+=`\n${contextInfo}`);const stream=session.promptStreaming(`\n            You are an AI writing assistant. Your goal is to help users with writing tasks by generating relevant and high-quality text. Do NOT answer questions; simply write on behalf of the user. Use the provided "input" (writing task) and "context" (extra information) to tailor your response. Focus on producing error-free and engaging writing. Do not explain your response, just provide the generated text please dont add any formatting or styling.\n      \n            Input: ${inputText}\n            Context: ${context}\n            `);let result="",previousChunk="";for await(const chunk of stream){const newContent=chunk,cleanedContent=newContent.replace(/[^\w\s.,!?:\[\]()\-]/g,"").replace(/[#*]/g,"");result+=cleanedContent,previousChunk=chunk;const footer=document.querySelector(".swal2-footer");footer&&(footer.style.display="none"),Swal.update({html:`<textarea class="result-content" disabled>${result}</textarea>`,footer:null,showCloseButton:!0,didClose:()=>{currentSession&&(currentSession.destroy(),currentSession=null)}});const textarea=document.querySelector(".result-content");textarea&&(textarea.scrollTop=textarea.scrollHeight),Swal.showLoading()}return result}catch(error){throw error}}async summarizeContent(content){const postContent=content;try{let currentSession=null;const summarizer=await window.ai.summarizer.create({sharedContext:"A blog post"});this.currentSession=summarizer,currentSession=summarizer;const stream=summarizer.summarizeStreaming(postContent,{context:"Avoid any toxic language and be as constructive as possible."});let result="";for await(const value of stream){let counter=1;result=value.replaceAll("\n\n\n\n","\n\n").replace(/^\s*[#*]/gm,()=>`${counter++}.`);const footer=document.querySelector(".swal2-footer");footer&&(footer.style.display="none"),Swal.update({html:`<textarea class="result-content" disabled>${result}</textarea>`,footer:null,showCloseButton:!0,didClose:()=>{currentSession&&(currentSession.destroy(),currentSession=null)}});const textarea=document.querySelector(".result-content");textarea&&(textarea.scrollTop=textarea.scrollHeight),Swal.showLoading()}return result}catch(error){}}async generateAIContent(chipText,text){if(!("ai"in self&&"summarizer"in self.ai&&"ai"in self&&"languageModel"in self.ai))return;let currentSession=null;const session=await window.ai.languageModel.create({systemPrompt:"Act as a professional content writer. Generate engaging, informative, and clear content without using markdown formatting of any kind like: * and #. Use bold text sparingly for headings, emphasis, or key points to enhance readability and highlight important information. For lists, use simple text-based formatting, such as:\n  - Bulleted points with hyphens or bullets\n  - Numbered lists with standard numbering\n  Ensure all content is free of special markdown syntax. Maintain a conversational, approachable tone."});this.currentSession=session;try{const prompt=`${text} ${chipText}`,response=await session.promptStreaming(prompt);let result="",previousChunk="";for await(const chunk of response){const newContent=chunk,cleanedContent=newContent.replace(/^#{1,6}\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/^\s*[-*+]\s/gm,"• ").replace(/[^\w\s.,!?:'\-•\[\]()]/g,"");result+=cleanedContent;const footer=document.querySelector(".swal2-footer");footer&&(footer.style.display="none"),Swal.update({html:`<textarea class="result-content" disabled>${result}</textarea>`,footer:null,showCloseButton:!0,didClose:()=>{currentSession&&(currentSession.destroy(),currentSession=null)}});const textarea=document.querySelector(".result-content");textarea&&(textarea.scrollTop=textarea.scrollHeight),Swal.showLoading()}return result}catch(error){}}getPromptData(){return{paragraph:{menuTitle:"Write a paragraph on this",prompt:"Write a well-structured paragraph on the following topic, maintaining clarity and coherence here is the topic:"},continue:{menuTitle:"Continue this text",prompt:"Continue the text exactly from where it ends, preserving its tone and style. Do not remove or alter any existing content.here is text: "},ideas:{menuTitle:"Generate ideas on this",prompt:"Generated ideas on this topic:"},article:{menuTitle:"Write an article about this",prompt:"Write a complete article about this:"},tldr:{menuTitle:"Generate a TL;DR",prompt:"Generate a TL;DR of this text:"}}}async genearteContentHandler(){if(!window.hasOwnProperty("chrome")||!navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edg"))return void Swal.fire({title:"Chrome Browser Required",html:'<div class="ai_text_model_error">\n            <p>This feature is exclusively supported on the Google Chrome browser.</p>\n           </div>',showCloseButton:!0,showConfirmButton:!1,width:400,customClass:{container:"aacgfe-modal-main-wrp"}});const chromeVersion=(()=>{const raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return raw?parseInt(raw[2],10):null})();if(null===chromeVersion||chromeVersion<132)return void Swal.fire({title:"Chrome Update Required",html:'<div class="ai_text_model_error">\n            <p>Please update your Chrome browser to version 132 or later to use this feature.</p>\n          </div>',showCloseButton:!0,showConfirmButton:!1,width:400,customClass:{container:"aacgfe-modal-main-wrp",title:"aacgfe-modal-title"}});if(!window.isSecureContext)return void Swal.fire({title:"⚠ Your connection is not secure!",html:'<div class="ai_text_model_error secure_check">\n                <p>To secure your connection, follow these steps:</p>\n                <ol>\n                    <li>Open a new tab and go to: <b>chrome://flags/#unsafely-treat-insecure-origin-as-secure</b></li>\n                    <li>Enable the flag and add paste your site URL.</li>\n                    <li>Then relaunch your browser.</li>\n                </ol>\n            </div>',showCloseButton:!0,showConfirmButton:!1,width:600,customClass:{container:"aacgfe-modal-main-wrp secure_tab_notice",title:"aacgfe-modal-title"}});if(!("ai"in self&&"summarizer"in self.ai&&"ai"in self&&"languageModel"in self.ai))return void Swal.fire({title:"AI Model Unavailable",html:'<div class="ai_text_model_error"><p><b> Warning! Ensure the AI model is installed in your browser by referring to the official  <a href="https://developer.chrome.com/docs/ai/built-in-apis" target="_blank" rel="noopener noreferrer">Chrome AI Model documentation</a>. Then, enable these flags:</b>\n            <ol>\n              <li>Please update your Chrome browser to version 132 or later.</li>\n              <li>Copy this flag and paste it in your chrome browser search bar</li>\n              <li><code class="aacgfe-code-block">chrome://flags/#optimization-guide-on-device-model</code> – Enabled BypassPerfRequirement this flag.</li>\n              <li><code class="aacgfe-code-block">chrome://flags/#prompt-api-for-gemini-nano</code> - Enable this flag.</li>\n              <li><code class="aacgfe-code-block">chrome://flags/#summarization-api-for-gemini-nano</code> – Enable this flag.</li>\n              <li>Then relaunch your browser</li>\n            </ol>\n            <p><b>For more details, check the official <a href="https://docs.coolplugins.net/docs/ai-content-generator-for-elementor/" target="_blank">documentation</a></b></p>\n            </div>',showCloseButton:!0,showConfirmButton:!1,width:600,customClass:{container:"aacgfe-modal-main-wrp"},didOpen:()=>{document.querySelector(".swal2-html-container").addEventListener("click",(function(event){let link=event.target.closest("a");link&&(event.preventDefault(),window.open(link.href,"_blank"))}))}});let available=(await self.ai.languageModel.capabilities()).available,availablesum=(await self.ai.summarizer.capabilities()).available;async function withTimeout(promise,timeout=100){return Promise.race([promise,new Promise((_,reject)=>setTimeout(()=>reject(new Error("Timeout exceeded")),timeout))])}if("readily"!==available)try{await withTimeout(self.ai.languageModel.create(),100)}catch(error){}if("readily"!==availablesum)try{await withTimeout(self.ai.summarizer.create(),100)}catch(error){}if(available=(await self.ai.languageModel.capabilities()).available,availablesum=(await self.ai.summarizer.capabilities()).available,"no"===available||"after-download"===available||"no"===availablesum||"after-download"===availablesum)return void Swal.fire({title:"AI Model Unavailable",html:'<div class="ai_text_model_error"><p><b> Warning! Ensure the AI model is installed in your browser by referring to the official  <a href="https://developer.chrome.com/docs/ai/built-in-apis" target="_blank">Chrome AI Model documentation</a>. Then, enable these flags:</b>\n              <ol>\n                <li>Please update your Chrome browser to version 132 or later.</li>\n                <li>Copy this flag and paste it in your chrome browser search bar</li>\n                <li><code class="aacgfe-code-block">chrome://flags/#optimization-guide-on-device-model</code> – Enabled BypassPerfRequirement this flag.</li>\n                <li><code class="aacgfe-code-block">chrome://flags/#prompt-api-for-gemini-nano</code> - Enable this flag.</li>\n                <li><code class="aacgfe-code-block">chrome://flags/#summarization-api-for-gemini-nano</code> – Enable this flag.</li>\n                <li>Then relaunch your browser</li>\n              </ol>\n              <p><b>For more details, check the official <a href="https://docs.coolplugins.net/docs/ai-content-generator-for-elementor/" target="_blank">documentation</a></b></p>\n              </div>',showCloseButton:!0,showConfirmButton:!1,width:600,customClass:{container:"aacgfe-modal-main-wrp"},didOpen:()=>{document.querySelector(".swal2-html-container").addEventListener("click",(function(event){let link=event.target.closest("a");link&&(event.preventDefault(),window.open(link.href,"_blank"))}))}});const content=await this.getContent();if(!content||""===content.trim())return void Swal.fire({html:'<div class="ai_text_model_error_content"><p>Please enter some content first</p></div>',showCloseButton:!0,showConfirmButton:!1});const promptData=this.getPromptData(),resultContent=document.querySelector(".result-content");resultContent&&(resultContent.value="");const promptOptions=Object.entries(promptData).map(([key,value])=>`\n            <option value="${key}">${value.menuTitle}</option>\n          `).join("");Swal.fire({title:"AI Content Generator",html:`<div><p>Generate Content in Few Seconds With Chrome Built-in AI. </p></div>\n            <div class="ai-content-generator">\n              <div class="input-wrapper">\n                <textarea class="ai-prompt-input" disabled>${content}</textarea>\n              </div>\n              <div class="suggested-prompts">\n                <h6>Suggested Prompts</h6>\n                <div class="prompt-chips">\n                  <button class="prompt-chip">Make it shorter</button>\n                  <button class="prompt-chip">Make it longer</button>\n                  <button class="prompt-chip">Fix the grammar</button>\n                  <button class="prompt-chip">Write on this topic</button>\n                  <button class="prompt-chip">Summarize this</button>\n                   <select id="custom-prompts" class="custom-prompt-select">\n                    <option value="" disabled selected>Select a prompt</option>\n                    ${promptOptions}\n                  </select>\n                </div>\n              \n              </div>\n            </div>`,footer:'<div class="result-actions">\n            <button class="regenerate-btn" id="ai_regenrate_button">Generate Text</button>\n          </div>',showCloseButton:!0,customClass:{container:"aacgfe-modal-main-wrp",loader:"loading"},showConfirmButton:!1,width:600,didOpen:()=>{const input=document.querySelector(".ai-prompt-input"),modal=document.querySelector(".swal2-container"),customPromptSelect=document.querySelector("#custom-prompts");modal.addEventListener("mousedown",e=>e.stopPropagation()),modal.addEventListener("mouseup",e=>e.stopPropagation()),modal.addEventListener("click",e=>e.stopPropagation()),modal.addEventListener("focus",e=>e.stopPropagation(),!0);let promptText="";document.querySelectorAll(".prompt-chip").forEach(chip=>{chip.addEventListener("click",()=>(document.querySelectorAll(".prompt-chip").forEach(c=>{c.classList.remove("active")}),chip.classList.add("active"),customPromptSelect.value="",promptText=chip.textContent,promptText))}),customPromptSelect.addEventListener("change",e=>{document.querySelectorAll(".prompt-chip").forEach(chip=>{chip.classList.remove("active")});const selectedPrompt=promptData[e.target.value];selectedPrompt&&(promptText=selectedPrompt.prompt.replace("[[text]]",content))});const generateContent=async()=>{const promptddText=promptText;if(!promptText)return;let result;if(document.querySelector(".suggested-prompts").style.display="none",Swal.showLoading(),document.querySelector("#ai_regenrate_button").style.display="none",document.querySelector(".swal2-container").classList.add("loading"),"Summarize this"===promptddText)try{result=await this.summarizeContent(content)}catch(error){}else if("Make it shorter"===promptddText)try{result=await this.shortContent(content)}catch(error){}else if("Write on this topic"===promptddText)try{result=await this.writeContent(content)}catch(error){}else try{result=await this.generateAIContent(content,promptText)}catch(error){}result&&(Swal.fire({title:"AI Content Generator",width:600,html:`<textarea class="result-content" disabled>${result}</textarea>`,showConfirmButton:!1,footer:'<div class="ai_footer_main_div">\n                    <button class="regenerate-btn" id="ai_new_promt_button">New Prompt</button>\n                    <button class="regenerate-btn" id="ai_use_text_button">Use Text</button>\n                  </div>',showCloseButton:!0,customClass:{container:"aacgfe-modal-main-wrp",loader:"loading"}}),document.getElementById("ai_use_text_button").addEventListener("click",()=>{try{const content=result.trim().replace(/\r?\n/g,"<br />");if(window.parent.tinyMCE){const editorId=this.editor.attr("id"),activeEditor=window.parent.tinyMCE.get(editorId);activeEditor&&(activeEditor.setContent(content),activeEditor.fire("change"))}else this.editor.val(content),this.editor.trigger("change");Swal.close()}catch(error){this.editor.val(result.trim()),this.editor.trigger("change"),Swal.close()}}),document.getElementById("ai_new_promt_button").addEventListener("click",ele=>{ele.stopPropagation(),this.genearteContentHandler()}))};input.addEventListener("keypress",e=>{"Enter"===e.key&&generateContent()}),document.querySelector(".regenerate-btn").addEventListener("click",generateContent)},willClose:()=>{var closebtn=document.querySelectorAll(".swal2-close");if(this.currentSession)try{this.currentSession.destroy(),this.currentSession=null}catch(error){}}})}}$(window).on("elementor/frontend/init",(function(){elementor.channels.editor.on("ai:content:generate",(function(controlView){const obj=new HandleAll(controlView);obj.genearteContentHandler()}))}))}(jQuery);